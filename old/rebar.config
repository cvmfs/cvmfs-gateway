{erl_opts, [debug_info]}.
{deps, [
        {lager, "3.6.8"},
        {cowboy, "2.6.1"},
        {jsx, "2.9.0"},
        {uuid, "1.7.5", {pkg, uuid_erl}},
        {poolboy, "1.5.2"},
        {lager_syslog, {git, "https://github.com/cvmfs/lager_syslog.git", {tag, "3.0.4"}}}
       ]}.
{relx, [{release, {cvmfs_gateway, "1.0.0"}
        ,[cvmfs_gateway,
          mnesia,
          lager,
          lager_syslog,
          cowboy,
          jsx,
          poolboy,
          uuid,
          runtime_tools,
          sasl]}

       ,{sys_config, "./config/sys.config.rel"}
       ,{vm_args, "./config/vm.args"}

       ,{overlay, [{mkdir, "etc"}
                  ,{mkdir, "log"}
                  ,{copy, "./config/repo.json", "etc/repo.json"}
                  ,{copy, "./config/user.json", "etc/user.json"}
                  ,{copy, "./scripts/90-cvmfs-gateway.conf", "scripts/90-cvmfs-gateway.conf"}
                  ,{copy, "./scripts/90-cvmfs-gateway-rotate", "scripts/90-cvmfs-gateway-rotate"}
                  ,{copy, "./scripts/90-cvmfs-gateway-rotate-systemd", "scripts/90-cvmfs-gateway-rotate-systemd"}
                  ,{copy, "./scripts/run_cvmfs_gateway.sh", "scripts/run_cvmfs_gateway.sh"}
                  ,{copy, "./scripts/get_leases.sh",      "scripts/get_leases.sh"}
                  ,{copy, "./scripts/get_leases.escript", "scripts/get_leases.escript"}
                  ,{copy, "./scripts/clear_leases.sh",      "scripts/clear_leases.sh"}
                  ,{copy, "./scripts/clear_leases.escript", "scripts/clear_leases.escript"}
                  ,{copy, "./scripts/reload_repo_config.escript", "scripts/reload_repo_config.escript"}
                  ,{copy, "./scripts/setup.sh", "scripts/setup.sh"}
                  ,{copy, "./scripts/setup_mnesia.escript", "scripts/setup_mnesia.escript"}
                  ,{copy, "./scripts/cvmfs-gateway.service", "scripts/cvmfs-gateway.service"}
                  ,{copy, "./scripts/cvmfs-gateway.initd", "scripts/cvmfs-gateway.initd"}]}

       ,{dev_mode, true}
       ,{include_erts, false}
       ,{system_libs, false}

       ,{extended_start_script, true}]}.

{profiles, [{prod, [{relx, [{dev_mode, false}
                           ,{include_erts, true}
                           ,{system_libs, true}]}]}
           ,{test, [{deps, [
                            {proper, "1.3.0"},
                            {gun, "1.3.0"},
                            {macaroons, "1.0.2", {git, "https://github.com/cvmfs/macaroons.git", {tag, "1.0.2"}}}
                           ]}]}]}.

